<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crazy 8s</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        [contenteditable=true]:empty:before {
            content: attr(placeholder);
            pointer-events: none;
            display: block;
            color: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <div class="text-center bg-gray-800 p-6 rounded-2xl shadow-lg mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Crazy 8s</h1>
            <p class="text-gray-400 mt-2 max-w-2xl mx-auto">Tienes 8 minutos para bocetar 8 ideas basadas en las siguientes consignas. ¡Una por recuadro!</p>
            
            <div class="mt-6">
                <div id="timer-display" class="text-6xl font-bold text-purple-400 tracking-wider">08:00</div>
                <button id="start-timer-btn" class="mt-4 px-8 py-3 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75 transition-transform transform hover:scale-105">
                    Iniciar Temporizador
                </button>
            </div>
            <div id="finished-message" class="hidden mt-4 px-4 py-2 bg-green-900 bg-opacity-50 text-green-300 font-semibold rounded-lg">
                ¡Tiempo! Es hora de compartir tus ideas.
            </div>
            <!-- Botones de Acción -->
            <div class="flex flex-col sm:flex-row justify-center items-center space-y-3 sm:space-y-0 sm:space-x-4 mt-6">
                 <button id="save-btn" class="w-full sm:w-auto px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition">Guardar Progreso</button>
                 <button id="send-btn" class="w-full sm:w-auto px-6 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 transition">Enviar Respuestas</button>
            </div>
             <div id="status-message" class="mt-4 text-sm font-medium h-5"></div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
            <!-- Las tarjetas se generan aquí -->
        </div>

    </div>

    <!-- Modal para enviar respuestas -->
    <div id="send-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-md transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
            <h2 class="text-2xl font-bold text-white mb-4">Enviar Respuestas</h2>
            <p class="text-gray-400 mb-6">Por favor, ingresa tu nombre para identificar tus ideas en la hoja de cálculo.</p>
            <input type="text" id="userName" placeholder="Tu Nombre" class="w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-purple-500 outline-none mb-2">
            <div id="send-error" class="text-red-400 text-sm hidden h-5">El nombre no puede estar vacío.</div>
            <div class="flex justify-end space-x-4 mt-6">
                <button id="cancel-send-btn" class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-500 transition">Cancelar</button>
                <button id="confirm-send-btn" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition flex items-center">
                    <span id="confirm-btn-text">Confirmar y Enviar</span>
                    <svg id="loading-spinner" class="animate-spin -mr-1 ml-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- IMPORTANTE ---
        // 1. Crea un Google Apps Script con el código proporcionado en el otro archivo.
        // 2. Despliégalo como Web App.
        // 3. Pega la URL de la Web App aquí abajo.
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw2c4SeWl_ftf3wroP2Kjv9hPyu5Mc6-u59QWgQaKXXa4T32Bp6yBmwQXM2zZ18RkcQ/exec';

        const grid = document.querySelector('.grid');
        const timerDisplay = document.getElementById('timer-display');
        const startButton = document.getElementById('start-timer-btn');
        const finishedMessage = document.getElementById('finished-message');
        const saveButton = document.getElementById('save-btn');
        const sendButton = document.getElementById('send-btn');
        const statusMessage = document.getElementById('status-message');
        
        // Modal elements
        const sendModal = document.getElementById('send-modal');
        const modalContent = document.getElementById('modal-content');
        const cancelSendBtn = document.getElementById('cancel-send-btn');
        const confirmSendBtn = document.getElementById('confirm-send-btn');
        const userNameInput = document.getElementById('userName');
        const sendError = document.getElementById('send-error');
        const loadingSpinner = document.getElementById('loading-spinner');
        const confirmBtnText = document.getElementById('confirm-btn-text');
        
        let timer;
        let timeInSeconds = 8 * 60;
        let isTimerRunning = false;

        const prompts = ["Otro sector: ¿Qué harían en...?", "Sin límite de presupuesto", "Sin invertir 1 dólar", "La peor idea (anti-requisito)", "100% digital", "100% análoga", "Hace 50 años", "Dentro de 50 años"];
        const colors = [
            { bg: 'bg-sky-900 bg-opacity-50', text: 'text-sky-300', ring: 'focus:ring-sky-500' }, { bg: 'bg-rose-900 bg-opacity-50', text: 'text-rose-300', ring: 'focus:ring-rose-500' }, { bg: 'bg-emerald-900 bg-opacity-50', text: 'text-emerald-300', ring: 'focus:ring-emerald-500' }, { bg: 'bg-amber-900 bg-opacity-50', text: 'text-amber-300', ring: 'focus:ring-amber-500' }, { bg: 'bg-indigo-900 bg-opacity-50', text: 'text-indigo-300', ring: 'focus:ring-indigo-500' }, { bg: 'bg-orange-900 bg-opacity-50', text: 'text-orange-300', ring: 'focus:ring-orange-500' }, { bg: 'bg-teal-900 bg-opacity-50', text: 'text-teal-300', ring: 'focus:ring-teal-500' }, { bg: 'bg-slate-700', text: 'text-slate-300', ring: 'focus:ring-slate-500' }
        ];

        function generateCards() {
            grid.innerHTML = ''; // Clear existing cards
            for (let i = 1; i <= 8; i++) {
                const card = document.createElement('div');
                const color = colors[i - 1];
                const promptText = prompts[i - 1];
                card.className = 'bg-gray-800 rounded-2xl shadow-md p-5 flex flex-col aspect-square transition-all duration-300';
                card.innerHTML = `
                    <div class="flex-shrink-0">
                        <span class="${color.bg} ${color.text} font-bold text-sm px-3 py-1 rounded-full">${i}</span>
                    </div>
                    <h3 class="font-semibold text-lg mt-3 text-gray-100">${promptText}</h3>
                    <div class="idea-box mt-2 flex-grow w-full h-full text-base outline-none focus:ring-2 ${color.ring} rounded-md p-2 overflow-y-auto" contenteditable="true" placeholder="Tu idea aquí..."></div>`;
                grid.appendChild(card);
            }
        }
        
        function showStatusMessage(message, color = 'green', duration = 3000) {
            statusMessage.textContent = message;
            statusMessage.className = `mt-4 text-sm font-medium h-5 text-${color}-400`;
            setTimeout(() => {
                statusMessage.textContent = '';
            }, duration);
        }

        function saveProgress() {
            const ideas = Array.from(document.querySelectorAll('.idea-box')).map(box => box.innerHTML);
            localStorage.setItem('crazy8s_ideas', JSON.stringify(ideas));
            showStatusMessage('Progreso guardado localmente.', 'blue');
        }

        function loadProgress() {
            const savedIdeas = localStorage.getItem('crazy8s_ideas');
            if (savedIdeas) {
                const ideas = JSON.parse(savedIdeas);
                const ideaBoxes = document.querySelectorAll('.idea-box');
                ideaBoxes.forEach((box, index) => {
                    if (ideas[index]) {
                        box.innerHTML = ideas[index];
                    }
                });
                showStatusMessage('Progreso anterior cargado.', 'gray', 5000);
            }
        }

        function handleSend() {
            if (GOOGLE_APPS_SCRIPT_URL === 'URL_DE_TU_WEB_APP_AQUI') {
                showStatusMessage('Error: La URL de Google Apps Script no está configurada.', 'red', 5000);
                alert('Por favor, configura la URL de Google Apps Script en el archivo HTML para poder enviar las respuestas.');
                return;
            }
            sendModal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeModal() {
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                sendModal.classList.add('hidden');
                sendError.classList.add('hidden');
                userNameInput.value = '';
            }, 300);
        }

        async function confirmSend() {
            const name = userNameInput.value.trim();
            if (!name) {
                sendError.classList.remove('hidden');
                return;
            }
            sendError.classList.add('hidden');

            loadingSpinner.classList.remove('hidden');
            confirmBtnText.textContent = 'Enviando...';
            confirmSendBtn.disabled = true;

            const ideas = Array.from(document.querySelectorAll('.idea-box')).map(box => box.innerText);
            const payload = { name, ideas };

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Para evitar problemas de CORS con Apps Script
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                showStatusMessage('¡Respuestas enviadas con éxito!', 'green');
                closeModal();
            } catch (error) {
                console.error('Error sending data:', error);
                showStatusMessage('Error al enviar. Inténtalo de nuevo.', 'red');
            } finally {
                loadingSpinner.classList.add('hidden');
                confirmBtnText.textContent = 'Confirmar y Enviar';
                confirmSendBtn.disabled = false;
            }
        }

        // --- Lógica del Temporizador (sin cambios) ---
        function updateDisplay() {
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function startTimer() {
            if (isTimerRunning) return;
            isTimerRunning = true;
            startButton.disabled = true;
            startButton.classList.add('opacity-50', 'cursor-not-allowed');
            finishedMessage.classList.add('hidden');
            playNotificationSound(0.1);
            timer = setInterval(() => {
                timeInSeconds--;
                updateDisplay();
                if (timeInSeconds <= 0) {
                    clearInterval(timer);
                    timerDisplay.textContent = "00:00";
                    finishedMessage.classList.remove('hidden');
                    isTimerRunning = false;
                    startButton.disabled = false;
                    startButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    startButton.textContent = "Reiniciar";
                    timeInSeconds = 8 * 60;
                    playNotificationSound(0.5);
                }
            }, 1000);
        }
        
        function resetTimer() {
            clearInterval(timer);
            isTimerRunning = false;
            timeInSeconds = 8 * 60;
            updateDisplay();
            startButton.textContent = "Iniciar Temporizador";
            startButton.disabled = false;
            startButton.classList.remove('opacity-50', 'cursor-not-allowed');
            finishedMessage.classList.add('hidden');
        }

        startButton.addEventListener('click', () => {
            if (startButton.textContent === "Reiniciar") { resetTimer(); } else { startTimer(); }
        });
        
        function playNotificationSound(volume = 0.5) {
            try {
                const synth = new (window.Tone.Synth)().toDestination();
                synth.triggerAttackRelease("C5", "8n", window.Tone.now(), volume);
            } catch (e) {
                console.log("Audio context not available for sound notification.");
            }
        }
        
        // --- Event Listeners ---
        saveButton.addEventListener('click', saveProgress);
        sendButton.addEventListener('click', handleSend);
        cancelSendBtn.addEventListener('click', closeModal);
        confirmSendBtn.addEventListener('click', confirmSend);

        // --- Inicialización ---
        generateCards();
        loadProgress();
        updateDisplay();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
</body>
</html>

